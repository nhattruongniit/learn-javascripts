<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  lang="ja"
  xml:lang="ja"
  dir="ltr"
  xmlns:og="http://ogp.me/ns#"
  xmlns:fb="http://www.facebook.com/2008/fbml"
>
  <head>
    <title>Metric Tree Select</title>
  </head>

  <body>
    <div>
      <h2>Metric Tree Select</h2>
    </div>

    <script type="text/javascript">
      const input = [
        {
          title: "User count Parent",
          key: "user_count_parent",
          children: [
            {
              title: "User count",
              key: "user_count",
              children: [
                { title: "gm00_user_count", key: "gm00_user_count" },
                { title: "gm01_user_count", key: "gm01_user_count" },
              ],
            },
          ],
        },
        {
          title: "Retention ULRD",
          key: "retention_urld",
          children: [
            {
              title: "Ad impression",
              key: "ad_impression",
              children: [
                { title: "gm00_ad_impression", key: "gm00_ad_impression" },
              ],
            },
            {
              title: "Value combine",
              key: "value_combine",
              children: [
                { title: "gm00_value_combine", key: "gm00_value_combine" },
              ],
            },
            {
              title: "Ad value (URLD)",
              key: "ad_value_urld",
              children: [],
            },
          ],
        },
        {
          title: "FB login click",
          key: "fb_login_click",
        },
      ];

      const checkedKeys = [
        "gm00_user_count",
        "gm00_ad_impression",
        "ad_impression",
        "ad_value_urld",
      ];

      const checkedNotes = [
        { title: "gm00_user_count", key: "gm00_user_count" },
        { title: "gm00_ad_impression", key: "gm00_ad_impression" },
        {
          title: "Ad impression",
          key: "ad_impression",
          children: [
            { title: "gm00_ad_impression", key: "gm00_ad_impression" },
          ],
        },
        {
          title: "Ad value (URLD)",
          key: "ad_value_urld",
          children: [],
        },
      ];

      const output = [
        {
          title: "User count Parent",
          key: "user_count_parent",
          disableCheckbox: true,
          children: [
            {
              title: "User count",
              key: "user_count",
              disableCheckbox: true,
              children: [
                {
                  title: "gm00_user_count",
                  key: "gm00_user_count",
                  disableCheckbox: true,
                },
              ],
            },
          ],
        },
        {
          title: "Retention ULRD",
          key: "retention_urld",
          disableCheckbox: true,
          children: [
            {
              title: "Ad impression",
              key: "ad_impression",
              disableCheckbox: true,
              children: [
                {
                  title: "gm00_ad_impression",
                  key: "gm00_ad_impression",
                  disableCheckbox: true,
                },
              ],
            },
            {
              title: "Value combine",
              key: "value_combine",
              disableCheckbox: true,
              children: [
                {
                  title: "gm00_value_combine",
                  key: "gm00_value_combine",
                  disableCheckbox: true,
                },
              ],
            },
          ],
        },
      ];

      function mapInputToOutput(input, checkedNotes) {
        const output = [];
        const checkedNotesKeys = checkedNotes.map((note) => note.key);
        console.log("checkedNotesKeys: ", checkedNotesKeys);

        const traverse = (input, checkedNotesKeys) => {
          const output = [];
          for (let i = 0; i < input.length; i++) {
            const node = input[i];
            const { key, title, children } = node;
            const isNodeChecked = checkedNotesKeys.includes(key);

            if (isNodeChecked) {
              output.push({
                ...node,
                disableCheckbox: true,
                children: traverse(children || [], checkedNotesKeys),
              });
            } else {
              const childrenOutput = traverse(children || [], checkedNotesKeys);
              if (childrenOutput.length > 0) {
                output.push({
                  ...node,
                  children: childrenOutput,
                });
              }
            }
          }
          return output;
        };

        return traverse(input, checkedNotesKeys);
      }

      console.log("checkedNotes: ", {
        input,
        checkedNotes,
        output: mapInputToOutput(input, checkedNotes),
      });
    </script>
  </body>
</html>
